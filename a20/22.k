#!../k
a:`I$1_'"\n"\'"\n\n"\1:"i/22"
+/r*1+|!#r:,/(&/#:'){w:</c:*'x;@[1_'x;w;,;w|:/c]}/a

f:{n:*'x;e:1_'x;($[~^y?hx;1,,!0;e,'(n i;!0)i:>$[|/n>#'e;n;#'g n#'e]];y,hx:h x)}. /step
g:{*(&/#'*:)f/(x;!0)} /game
h:{+/#[#y;x]*y:(*y),0,*|y}99(37*)\1 /hash
+/r*|1+!#r:,/g a
